# Grid to Grid Probabilistic Reflectivity using EnsembleStat output

[config]
# time looping - options are INIT, VALID, RETRO, and REALTIME
LOOP_BY = VALID

# Format of VALID_BEG and VALID_END
VALID_TIME_FMT = %Y%m%d%H

# Start time for METplus run
#VALID_BEG = 2019050500
VALID_BEG = {ENV[YYYYMMDDHH]}

# End time for METplus run
VALID_END = {ENV[YYYYMMDDHH]}

# Increment between METplus runs in seconds. Must be >= 60
VALID_INCREMENT = 86400

# Options are times, processes
# times = run all items in the PROCESS_LIST for a single initialization
# time, then repeat until all times have been evaluated.
# processes = run each item in the PROCESS_LIST for all times
#   specified, then repeat for the next item in the PROCESS_LIST.
LOOP_ORDER = times

# List of applications to run
PROCESS_LIST = GridStat

# run pcp_combine on forecast data
#FCST_PCP_COMBINE_RUN = False

# mode of pcp_combine to use (SUM, ADD, SUBTRACT)
#FCST_PCP_COMBINE_METHOD = SUM

# list of variables to compare
FCST_VAR1_NAME = REFC_L0_ENS_NMEP_ge15_NBRHD{ENV[POINTS]}_GAUSSIAN1
FCST_VAR1_LEVELS = L0
FCST_VAR1_THRESH =  
FCST_VAR1_OPTIONS = 

FCST_VAR2_NAME = REFC_L0_ENS_NMEP_ge20_NBRHD{ENV[POINTS]}_GAUSSIAN1
FCST_VAR2_LEVELS = L0
FCST_VAR2_THRESH =  
FCST_VAR2_OPTIONS = 

FCST_VAR3_NAME = REFC_L0_ENS_NMEP_ge25_NBRHD{ENV[POINTS]}_GAUSSIAN1
FCST_VAR3_LEVELS = L0
FCST_VAR3_THRESH =  
FCST_VAR3_OPTIONS = 

FCST_VAR4_NAME = REFC_L0_ENS_NMEP_ge30_NBRHD{ENV[POINTS]}_GAUSSIAN1
FCST_VAR4_LEVELS = L0
FCST_VAR4_THRESH =  
FCST_VAR4_OPTIONS = 

FCST_VAR5_NAME = REFC_L0_ENS_NMEP_ge35_NBRHD{ENV[POINTS]}_GAUSSIAN1
FCST_VAR5_LEVELS = L0
FCST_VAR5_THRESH =  
FCST_VAR5_OPTIONS = 

FCST_VAR6_NAME = REFC_L0_ENS_NMEP_ge40_NBRHD{ENV[POINTS]}_GAUSSIAN1
FCST_VAR6_LEVELS = L0
FCST_VAR6_THRESH =  
FCST_VAR6_OPTIONS = 

FCST_VAR7_NAME = REFC_L0_ENS_NMEP_ge45_NBRHD{ENV[POINTS]}_GAUSSIAN1
FCST_VAR7_LEVELS = L0
FCST_VAR7_THRESH =  
FCST_VAR7_OPTIONS = 

#FCST_VAR1_OPTIONS = prob_as_scalar = TRUE;

# list of forecast leads to process
LEAD_SEQ = {ENV[FCSTLEN]}

# description of data to be processed
# used in output file path
MODEL = {ENV[MODEL]}
OBTYPE = {ENV[OBS]}

# location of grid_stat MET config file
GRID_STAT_CONFIG_FILE = {CONFIG_DIR}/grid_stat/GridStatConfig_ENS_CNT_N{ENV[NEIGHBORHOOD]}

# Forecast data description variables
#FCST_PCP_COMBINE_INPUT_DATATYPE = GRIB
#FCST_GRID_STAT_PROB_THRESH =  ge15
FCST_GRID_STAT_INPUT_DATATYPE = NETCDF
FCST_IS_PROB = True
#FCST_PCP_COMBINE_INPUT_LEVEL = 6
#FCST_PCP_COMBINE_IS_DAILY_FILE = false

# Observation data description variables
# 
OBS_VAR1_NAME = var209_10_0_500mabovemeansealevel
OBS_VAR1_LEVELS = L0
OBS_VAR1_THRESH = >=15

OBS_VAR2_NAME = var209_10_0_500mabovemeansealevel
OBS_VAR2_LEVELS = L0
OBS_VAR2_THRESH = >=20

OBS_VAR3_NAME = var209_10_0_500mabovemeansealevel
OBS_VAR3_LEVELS = L0
OBS_VAR3_THRESH = >=25

OBS_VAR4_NAME = var209_10_0_500mabovemeansealevel
OBS_VAR4_LEVELS = L0
OBS_VAR4_THRESH = >=30

OBS_VAR5_NAME = var209_10_0_500mabovemeansealevel
OBS_VAR5_LEVELS = L0
OBS_VAR5_THRESH = >=35

OBS_VAR6_NAME = var209_10_0_500mabovemeansealevel
OBS_VAR6_LEVELS = L0
OBS_VAR6_THRESH = >=40

OBS_VAR7_NAME = var209_10_0_500mabovemeansealevel
OBS_VAR7_LEVELS = L0
OBS_VAR7_THRESH = >=45

##################################
[dir]
#
MET_BASE = {ENV[MET_BASE]}
MET_INSTALL_DIR = {ENV[MET_DIR]}
# input and output data directories
FCST_GRID_STAT_INPUT_DIR = {ENV[MODELDIR]}
INPUT_BASE = {ENV[MODELDIR]}
OBS_GRID_STAT_INPUT_DIR = {ENV[OBSDIR]}

#GRID_STAT_OUTPUT_DIR = {OUTPUT_BASE}/uswrp/met_out/{MODEL}/precip
OUTPUT_BASE = {ENV[REALTIMEDIR]}
GRID_STAT_OUTPUT_DIR = {OUTPUT_BASE}
#TMP_DIR = {GRID_STAT_OUTPUT_DIR}/{valid?fmt=%Y%m%d}-{valid?fmt=%H}z/tmp
TMP_DIR = {GRID_STAT_OUTPUT_DIR}/tmp

# location of configuration files used by MET applications
CONFIG_DIR= {ENV[CFGDIR]}/met

##################################
[filename_templates]
# format of filenames
FCST_GRID_STAT_INPUT_TEMPLATE = {valid?fmt=%Y%m%d-%Hz}/ensemble_stat/ensemble_stat_{lead?fmt=%3H}_G25_N{ENV[NEIGHBORHOOD]}_{valid?fmt=%Y%m%d}_{valid?fmt=%H}0000V_ens.nc

OBS_GRID_STAT_INPUT_TEMPLATE = {valid?fmt=%Y%m%d}-{valid?fmt=%H}z/mrms_mosaic_G25_N{ENV[POINTS]}.nc

GRID_STAT_OUTPUT_TEMPLATE = {valid?fmt=%Y%m%d}-{valid?fmt=%H}z/grid_stat

##################################
[exe]
# Needed executables
WGRIB2 = /apps/wgrib2/0.1.9.6a/bin/wgrib2
CUT = /bin/cut
TR = /bin/tr
RM = /bin/rm
NCAP2 = /apps/nco/4.1.0-intel/bin/ncap2
CONVERT = /bin/convert
NCDUMP = /apps/netcdf/4.2.1.1-intel/bin/ncdump
EGREP = /bin/egrep
